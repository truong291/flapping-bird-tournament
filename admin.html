<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flapping Bird Tournament - Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        .page-title {
            text-align: center;
            color: #ffd700;
            margin: 20px 0;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .login-section {
            text-align: center;
            margin: 50px 0;
        }

        .connect-btn {
            background: #ffd700;
            color: #2d7b82;
            border: none;
            padding: 10px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .connect-btn:hover {
            background: #ffed4a;
            transform: translateY(-2px);
        }

        .admin-content {
            display: none;
        }

        .stats-section {
            background: #2d7b82;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-label {
            font-size: 10px;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 14px;
        }

        .bonus-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid #ffd700;
            color: #fff;
            padding: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            width: 200px;
            margin-top: 10px;
        }

        .control-section {
            background: #2d7b82;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .control-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 5px;
        }

        .control-btn {
            background: #ffd700;
            color: #2d7b82;
            border: none;
            padding: 10px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .control-btn:hover {
            background: #ffed4a;
        }

        .control-btn.active {
            background: #ff4444;
        }

        .note-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid #ffd700;
            color: #fff;
            padding: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            width: 100%;
            margin-top: 10px;
        }

        .settings-section {
            background: #2d7b82;
            padding: 20px;
            border-radius: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            background: rgba(0, 0, 0, 0.2);
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: #ffd700;
            color: #2d7b82;
        }

        .tab-content {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 5px;
        }

        .tab-content.active {
            display: block;
        }

        .setting-item {
            margin-bottom: 20px;
        }

        .setting-label {
            font-size: 10px;
            color: #ffd700;
            margin-bottom: 10px;
            display: block;
        }

        .setting-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid #ffd700;
            color: #fff;
            padding: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            width: 200px;
        }

        .add-btn {
            background: #ffd700;
            color: #2d7b82;
            border: none;
            padding: 10px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .add-btn:hover {
            background: #ffed4a;
        }

        .distribution-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .distribution-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid #ffd700;
            color: #fff;
            padding: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            width: 100px;
        }

        .delete-btn {
            background: #ff4444;
            color: #fff;
            border: none;
            padding: 5px 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #ff6666;
        }

        .submit-btn {
            background: #4CAF50;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            width: 100%;
        }

        .submit-btn:hover {
            background: #45a049;
        }

        .setting-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }

        .error-message {
            color: #ff4444;
            font-size: 10px;
            margin-top: 5px;
            display: none;
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .control-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1;
                min-width: 120px;
            }
        }

        /* Update popup styles to match game design */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .popup-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2d7b82;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ffd700;
            width: 300px;
            font-family: 'Press Start 2P', cursive;
            text-align: center;
        }

        .popup-message {
            color: #fff;
            font-size: 12px;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.5;
        }

        .popup-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .popup-btn {
            padding: 10px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            cursor: pointer;
            border: 2px solid #fff;
            background: transparent;
            color: #fff;
            min-width: 80px;
        }

        .popup-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .popup-yes {
            background: #ffd700;
            color: #2d7b82;
        }

        .popup-no {
            background: #ff4444;
        }

        .popup-ok {
            background: #ffd700;
            color: #2d7b82;
        }

        .game-settings-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .game-settings-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Add new styles for telegram notify section */
        .telegram-grid {
            display: grid;
            grid-template-columns: minmax(200px, 1fr);
            gap: 10px;
            max-width: 600px;
        }

        .telegram-button-grid {
            display: grid;
            grid-template-columns: minmax(200px, 1fr);
            gap: 10px;
        }

        @media (min-width: 768px) {
            .telegram-button-grid {
                grid-template-columns: 200px 200px 120px;
            }
        }

        .telegram-input {
            width: 100%;
            max-width: 520px;
        }

        .telegram-textarea {
            width: 100%;
            max-width: 520px;
            height: 100px;
            resize: vertical;
        }

        .telegram-line-input {
            width: 60px;
        }

        @media (max-width: 768px) {
            .telegram-button-grid {
                grid-template-columns: 1fr;
            }
            
            .telegram-input,
            .telegram-textarea {
                max-width: 100%;
            }

            .telegram-line-container {
                display: flex;
                gap: 10px;
                align-items: center;
            }

            .telegram-line-input {
                flex: 1;
                max-width: 100px;
            }
        }

        /* Update telegram notify section styles */
        .telegram-button-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: flex-start;
        }

        .telegram-button-name {
            width: 200px;
        }

        .telegram-button-url {
            width: 250px;
        }

        .telegram-button-line {
            width: 60px;
        }

        @media (max-width: 768px) {
            .telegram-button-row {
                flex-direction: column;
            }
            
            .telegram-button-name,
            .telegram-button-url,
            .telegram-input,
            .telegram-textarea {
                width: 100%;
                max-width: 100%;
            }

            .telegram-button-line {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="content-container">
        <h1 class="page-title">Admin Panel</h1>

        <!-- Login Section -->
        <div class="login-section" id="loginSection">
            <button class="connect-btn" onclick="connectWallet()">Connect Wallet</button>
        </div>

        <!-- Admin Content -->
        <div class="admin-content" id="adminContent">
            <!-- Stats Section -->
            <div class="stats-section">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Current Jackpot</div>
                        <div class="stat-value">0.00 BNB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Reserve Jackpot</div>
                        <div class="stat-value">0.00 BNB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Players</div>
                        <div class="stat-value">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Plays</div>
                        <div class="stat-value">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Dev Earn</div>
                        <div class="stat-value">0.00 BNB</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Bonus to Jackpot</div>
                    <input type="number" id="bonusInput" class="bonus-input" placeholder="0.00 BNB" step="0.01" min="0">
                    <button onclick="submitBonus()" class="control-btn" style="width: auto; margin-top: 10px;">Submit</button>
                    <button onclick="disconnectWallet()" class="control-btn" style="width: auto; margin-top: 10px; background: #ff4444;">Disconnect Wallet</button>
                </div>
            </div>

            <!-- Control Section -->
            <div class="control-section">
                <div class="control-grid">
                    <div class="control-item">
                        <button class="control-btn" onclick="togglePause(this)">Pause Game</button>
                        <input type="text" class="note-input" placeholder="Pause note...">
                    </div>
                    <div class="control-item">
                        <button class="control-btn" onclick="toggleMaintenance(this)">Maintenance</button>
                        <input type="text" class="note-input" placeholder="Maintenance note...">
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="settings-section">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('game')">Game Setting</button>
                    <button class="tab-btn" onclick="switchTab('bet')">Bet Setting</button>
                    <button class="tab-btn" onclick="switchTab('distribution')">Distribution Setting</button>
                    <button class="tab-btn" onclick="switchTab('telegram')">Telegram Notify</button>
                </div>

                <!-- Game Settings -->
                <div class="tab-content active" id="gameTab">
                    <form onsubmit="submitGameSettings(event)">
                        <div class="game-settings-grid">
                            <!-- Game Settings Column -->
                            <div>
                                <h3 style="color: #ffd700; margin-bottom: 20px; font-size: 14px;">Game Settings</h3>
                                <div class="setting-item">
                                    <label class="setting-label">PIPE GAP</label>
                                    <input type="number" class="setting-input" name="pipeGap" value="125" step="1" required>
                                </div>
                                <div class="setting-item">
                                    <label class="setting-label">GRAVITY</label>
                                    <input type="number" class="setting-input" name="gravity" value="0.25" step="0.01" required>
                                </div>
                                <div class="setting-item">
                                    <label class="setting-label">LIFT</label>
                                    <input type="number" class="setting-input" name="lift" value="-6" step="1" required>
                                </div>
                                <div class="setting-item">
                                    <label class="setting-label">PIPE SPEED</label>
                                    <input type="number" class="setting-input" name="pipeSpeed" value="2" step="1" required>
                                </div>
                            </div>
                            
                            <!-- Round Time Column -->
                            <div>
                                <h3 style="color: #ffd700; margin-bottom: 20px; font-size: 14px;">Round Time</h3>
                                <div class="setting-item">
                                    <label class="setting-label">Play Time (minutes)</label>
                                    <input type="number" class="setting-input" name="playTime" value="50" step="1" required>
                                </div>
                                <div class="setting-item">
                                    <label class="setting-label">Ranking & Reward Time (minutes)</label>
                                    <input type="number" class="setting-input" name="rewardTime" value="5" step="1" required>
                                </div>
                                <div class="setting-item">
                                    <label class="setting-label">New Round Preparation Time (minutes)</label>
                                    <input type="number" class="setting-input" name="prepTime" value="5" step="1" required>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="control-btn" style="margin-top: 20px;">Save Settings</button>
                    </form>
                </div>

                <!-- Bet Settings -->
                <div class="tab-content" id="betTab">
                    <form id="betSettingsForm" onsubmit="submitBetSettings(event)">
                        <div id="betInputs">
                            <div class="setting-row">
                                <div class="setting-item">
                                    <label class="setting-label">Bet 1</label>
                                    <input type="number" class="setting-input" name="bet1" placeholder="0.1 BNB" step="0.01" required min="0.01">
                                    <div class="error-message">Please enter a valid bet amount</div>
                                </div>
                            </div>
                            <div class="setting-row">
                                <div class="setting-item">
                                    <label class="setting-label">Bet 2</label>
                                    <input type="number" class="setting-input" name="bet2" placeholder="0.08 BNB" step="0.01" required min="0.01">
                                    <div class="error-message">Please enter a valid bet amount</div>
                                </div>
                                <button type="button" class="delete-btn" onclick="deleteBet(this)">Delete</button>
                            </div>
                            <div class="setting-row">
                                <div class="setting-item">
                                    <label class="setting-label">Bet 3</label>
                                    <input type="number" class="setting-input" name="bet3" placeholder="0.06 BNB" step="0.01" required min="0.01">
                                    <div class="error-message">Please enter a valid bet amount</div>
                                </div>
                                <button type="button" class="delete-btn" onclick="deleteBet(this)">Delete</button>
                            </div>
                            <div class="setting-row">
                                <div class="setting-item">
                                    <label class="setting-label">Bet 4</label>
                                    <input type="number" class="setting-input" name="bet4" placeholder="0.04 BNB" step="0.01" required min="0.01">
                                    <div class="error-message">Please enter a valid bet amount</div>
                                </div>
                                <button type="button" class="delete-btn" onclick="deleteBet(this)">Delete</button>
                            </div>
                            <div class="setting-row">
                                <div class="setting-item">
                                    <label class="setting-label">Bet 5</label>
                                    <input type="number" class="setting-input" name="bet5" placeholder="0.02 BNB" step="0.01" required min="0.01">
                                    <div class="error-message">Please enter a valid bet amount</div>
                                </div>
                                <button type="button" class="delete-btn" onclick="deleteBet(this)">Delete</button>
                            </div>
                        </div>
                        <button type="button" class="add-btn" onclick="addBetInput()">Add Bet</button>
                        <button type="submit" class="submit-btn">Save Bet Settings</button>
                    </form>
                </div>

                <!-- Distribution Settings -->
                <div class="tab-content" id="distributionTab">
                    <form id="distributionSettingsForm" onsubmit="submitDistributionSettings(event)">
                        <div id="distributionInputs">
                            <div class="distribution-item">
                                <input type="text" class="distribution-input" value="Top 1" readonly>
                                <input type="number" class="distribution-input" name="dist1" placeholder="50%" value="50" required min="0" max="100">
                                <div class="error-message">Please enter a value between 0 and 100</div>
                            </div>
                            <div class="distribution-item">
                                <input type="text" class="distribution-input" value="Top 2" readonly>
                                <input type="number" class="distribution-input" name="dist2" placeholder="20%" value="20" required min="0" max="100">
                                <button type="button" class="delete-btn" onclick="deleteDistribution(this)">Delete</button>
                                <div class="error-message">Please enter a value between 0 and 100</div>
                            </div>
                            <div class="distribution-item">
                                <input type="text" class="distribution-input" value="Top 3" readonly>
                                <input type="number" class="distribution-input" name="dist3" placeholder="15%" value="15" required min="0" max="100">
                                <button type="button" class="delete-btn" onclick="deleteDistribution(this)">Delete</button>
                                <div class="error-message">Please enter a value between 0 and 100</div>
                            </div>
                            <div class="distribution-item">
                                <input type="text" class="distribution-input" value="Top 4" readonly>
                                <input type="number" class="distribution-input" name="dist4" placeholder="10%" value="10" required min="0" max="100">
                                <button type="button" class="delete-btn" onclick="deleteDistribution(this)">Delete</button>
                                <div class="error-message">Please enter a value between 0 and 100</div>
                            </div>
                            <div class="distribution-item">
                                <input type="text" class="distribution-input" value="Top 5" readonly>
                                <input type="number" class="distribution-input" name="dist5" placeholder="5%" value="5" required min="0" max="100">
                                <button type="button" class="delete-btn" onclick="deleteDistribution(this)">Delete</button>
                                <div class="error-message">Please enter a value between 0 and 100</div>
                            </div>
                        </div>
                        <button type="button" class="add-btn" onclick="addDistributionInput()">Add Distribution</button>
                        <button type="submit" class="submit-btn">Save Distribution Settings</button>
                    </form>
                </div>

                <!-- Telegram Notify Settings -->
                <div class="tab-content" id="telegramTab">
                    <form id="telegramNotifyForm" onsubmit="submitTelegramNotify(event)">
                        <div class="setting-item">
                            <label class="setting-label">Image URL</label>
                            <input type="url" class="setting-input telegram-input" name="imageUrl" placeholder="https://example.com/image.jpg">
                        </div>
                        <div class="setting-item">
                            <label class="setting-label">Message Text</label>
                            <textarea class="setting-input telegram-textarea" name="messageText" placeholder="Enter your message here..."></textarea>
                        </div>
                        
                        <!-- Inline Buttons Section -->
                        <div id="buttonInputs">
                            <div class="setting-row">
                                <div class="setting-item">
                                    <label class="setting-label">Button 1</label>
                                    <div class="telegram-button-row">
                                        <input type="text" class="setting-input telegram-button-name" name="btn1_name" placeholder="Button Name">
                                        <input type="url" class="setting-input telegram-button-url" name="btn1_link" placeholder="https://">
                                        <input type="number" class="setting-input telegram-button-line" name="btn1_line" placeholder="Line" min="1" value="1">
                                        <button type="button" class="delete-btn" onclick="deleteTelegramButton(this)">Delete</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" class="add-btn" style="margin-bottom: 20px;">Add Button</button>
                        <button type="submit" class="submit-btn" style="margin: 0;">Send Notification</button>
                    </form>
                </div>
            </div>

            <!-- Blacklist Section -->
            <div class="settings-section" style="margin-top: 30px;">
                <div style="background: rgba(0, 0, 0, 0.2); padding: 30px; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid rgba(255,215,0,0.3); padding-bottom: 20px;">
                        <h3 style="color: #ffd700; font-size: 20px; font-family: 'Press Start 2P', cursive;">Blacklist Management</h3>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="color: #ffd700; font-size: 14px; font-family: 'Press Start 2P', cursive;">Records per page:</label>
                            <select id="blacklistPageSize" class="setting-input" style="width: 80px; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid #ffd700; color: #ffd700; border-radius: 4px; font-family: 'Press Start 2P', cursive;" onchange="updateBlacklistPage(1)">
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="20">20</option>
                            </select>
                        </div>
                    </div>

                    <form id="blacklistForm" onsubmit="submitBlacklist(event)" style="margin-bottom: 40px;">
                        <div style="display: grid; grid-template-columns: 30% 60% 10%; gap: 15px; align-items: start;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; color: #ffd700; font-size: 14px; font-family: 'Press Start 2P', cursive;">Wallet Address</label>
                                <input type="text" class="setting-input" name="walletAddress" placeholder="0x..." style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 2px solid #ffd700; color: #fff; border-radius: 4px; font-family: 'Press Start 2P', cursive; font-size: 12px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; color: #ffd700; font-size: 14px; font-family: 'Press Start 2P', cursive;">Reason</label>
                                <input type="text" class="setting-input" name="reason" placeholder="Enter reason for blacklisting..." style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 2px solid #ffd700; color: #fff; border-radius: 4px; font-family: 'Press Start 2P', cursive; font-size: 12px;">
                            </div>
                            <div style="padding-top: 32px;">
                                <button type="submit" class="control-btn" style="width: 100%; background: #ffd700; color: #000; border: none; padding: 12px; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: 12px; font-family: 'Press Start 2P', cursive;">Blacklist</button>
                            </div>
                        </div>
                    </form>

                    <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; border: 1px solid rgba(255,215,0,0.1);">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 2px solid #ffd700;">
                                    <th style="padding: 12px 16px; text-align: center; color: #ffd700; font-size: 12px; font-weight: 500; width: 10%; font-family: 'Press Start 2P', cursive;">No.</th>
                                    <th style="padding: 12px 16px; text-align: left; color: #ffd700; font-size: 12px; font-weight: 500; width: 20%; font-family: 'Press Start 2P', cursive;">Wallet</th>
                                    <th style="padding: 12px 16px; text-align: left; color: #ffd700; font-size: 12px; font-weight: 500; width: 60%; font-family: 'Press Start 2P', cursive;">Reason</th>
                                    <th style="padding: 12px 16px; text-align: center; color: #ffd700; font-size: 12px; font-weight: 500; width: 10%; font-family: 'Press Start 2P', cursive;">Action</th>
                                </tr>
                            </thead>
                            <tbody id="blacklistTableBody">
                                <!-- Sample row -->
                                <tr style="border-bottom: 1px solid rgba(255,215,0,0.1);">
                                    <td style="padding: 12px 16px; color: rgba(255,255,255,0.9); font-size: 12px; text-align: center; font-family: 'Press Start 2P', cursive;">1</td>
                                    <td style="padding: 12px 16px; color: rgba(255,255,255,0.9); font-size: 12px; font-family: 'Press Start 2P', cursive;">0x1234...5678</td>
                                    <td style="padding: 12px 16px; color: rgba(255,255,255,0.9); font-size: 12px; font-family: 'Press Start 2P', cursive;">Sample reason for blacklisting this wallet</td>
                                    <td style="padding: 12px 16px; text-align: center;">
                                        <button class="control-btn" onclick="unblacklistWallet(this)" data-wallet="0x1234...5678" style="width: 100%; background: transparent; color: #ffd700; border: 1px solid #ffd700; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 10px; font-family: 'Press Start 2P', cursive;">Unblacklist</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="pagination" style="display: flex; justify-content: center; gap: 10px; align-items: center; margin-top: 20px;">
                            <button class="control-btn" onclick="updateBlacklistPage('prev')" style="min-width: 40px; background: transparent; color: #ffd700; border: 1px solid #ffd700; padding: 2px 4px; border-radius: 4px; cursor: pointer; font-size: 10px; font-family: 'Press Start 2P', cursive;">Previous</button>
                            <div style="color: #ffd700; font-size: 10px; font-family: 'Press Start 2P', cursive;">Page <span id="currentBlacklistPage" style="font-weight: 500;">1</span> of <span id="totalBlacklistPages" style="font-weight: 500;">1</span></div>
                            <button class="control-btn" onclick="updateBlacklistPage('next')" style="min-width: 40px; background: transparent; color: #ffd700; border: 1px solid #ffd700; padding: 2px 4px; border-radius: 4px; cursor: pointer; font-size: 10px; font-family: 'Press Start 2P', cursive;">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Update popup HTML -->
    <div class="popup-overlay" id="questionPopup">
        <div class="popup-content">
            <div class="popup-message" id="popupMessage"></div>
            <div class="popup-buttons" id="popupButtons">
                <button class="popup-btn popup-yes" onclick="handleYes()">Yes</button>
                <button class="popup-btn popup-no" onclick="closePopup()">No</button>
            </div>
        </div>
    </div>

    <script>
        let currentCallback = null;
        let isAlert = false;

        // Mock wallet connection
        function connectWallet() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
        }

        // Question popup function
        function showQuestion(message, callback) {
            document.getElementById('popupMessage').textContent = message;
            document.getElementById('questionPopup').style.display = 'block';
            
            const buttons = document.getElementById('popupButtons');
            buttons.innerHTML = `
                <button class="popup-btn popup-yes" onclick="handleYes()">Yes</button>
                <button class="popup-btn popup-no" onclick="closePopup()">No</button>
            `;
            
            currentCallback = callback;
            isAlert = false;
        }

        // Alert popup function (OK only)
        function showAlert(message) {
            document.getElementById('popupMessage').textContent = message;
            document.getElementById('questionPopup').style.display = 'block';
            
            const buttons = document.getElementById('popupButtons');
            buttons.innerHTML = `
                <button class="popup-btn popup-ok" onclick="closePopup()">OK</button>
            `;
            
            isAlert = true;
            currentCallback = null;
        }

        function handleYes() {
            if (!isAlert && currentCallback) {
                currentCallback();
            }
            closePopup();
        }

        function closePopup() {
            document.getElementById('questionPopup').style.display = 'none';
            currentCallback = null;
            isAlert = false;
        }

        // Toggle pause/maintenance buttons with question
        function togglePause(btn) {
            const action = btn.classList.contains('active') ? 'resume' : 'pause';
            showQuestion(`Do you want to ${action} the game?`, () => {
                btn.classList.toggle('active');
                btn.textContent = btn.classList.contains('active') ? 'Resume Game' : 'Pause Game';
            });
        }

        function toggleMaintenance(btn) {
            const action = btn.classList.contains('active') ? 'end' : 'start';
            showQuestion(`Do you want to ${action} maintenance?`, () => {
                btn.classList.toggle('active');
                btn.textContent = btn.classList.contains('active') ? 'End Maintenance' : 'Maintenance';
            });
        }

        // Submit bonus to jackpot with question
        function submitBonus() {
            const bonusAmount = document.getElementById('bonusInput').value;
            showQuestion(`Do you want to add ${bonusAmount} BNB to jackpot?`, () => {
                console.log('Adding bonus:', bonusAmount, 'BNB');
                // Here you would typically send the data to your backend
                showAlert('Bonus added successfully!');
            });
        }

        // Submit game settings with question
        function submitGameSettings(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            // Validate total time must be whole hours
            const totalMinutes = parseInt(data.playTime) + parseInt(data.rewardTime) + parseInt(data.prepTime);
            if (totalMinutes % 60 !== 0) {
                showAlert('Total time must be in whole hours');
                return;
            }

            showQuestion('Do you want to update game settings?', () => {
                console.log('Game Settings:', data);
                // Here you would typically send the data to your backend
                showAlert('Game settings saved!');
            });
        }

        // Submit bet settings with question
        function submitBetSettings(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            showQuestion('Do you want to update bet settings?', () => {
                console.log('Bet Settings:', data);
                // Here you would typically send the data to your backend
                showAlert('Bet settings saved!');
            });
        }

        // Submit distribution settings with question
        function submitDistributionSettings(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            // Validate total percentage = 100
            const total = Object.values(data).reduce((sum, value) => sum + Number(value), 0);
            if (total !== 100) {
                showAlert('Total distribution must equal 100%');
                return;
            }

            showQuestion('Do you want to update distribution settings?', () => {
                console.log('Distribution Settings:', data);
                // Here you would typically send the data to your backend
                showAlert('Distribution settings saved!');
            });
        }

        // Submit telegram notification with validation
        function submitTelegramNotify(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            // Validate image URL
            if (!data.imageUrl.trim()) {
                showAlert('Please enter image URL');
                return;
            }

            // Validate message text
            if (!data.messageText.trim()) {
                showAlert('Please enter message text');
                return;
            }

            // Validate buttons
            const buttonInputs = document.getElementById('buttonInputs');
            const buttons = buttonInputs.children;
            for (let i = 0; i < buttons.length; i++) {
                const buttonNum = i + 1;
                const nameValue = data[`btn${buttonNum}_name`];
                const linkValue = data[`btn${buttonNum}_link`];
                const lineValue = data[`btn${buttonNum}_line`];

                if (!nameValue || !nameValue.trim()) {
                    showAlert(`Please enter name for Button ${buttonNum}`);
                    return;
                }
                if (!linkValue || !linkValue.trim()) {
                    showAlert(`Please enter URL for Button ${buttonNum}`);
                    return;
                }
                if (!lineValue || lineValue < 1) {
                    showAlert(`Please enter valid line number for Button ${buttonNum}`);
                    return;
                }
            }

            // Group buttons by line
            const buttonsByLine = {};
            for (let i = 0; i < buttons.length; i++) {
                const buttonNum = i + 1;
                const line = parseInt(data[`btn${buttonNum}_line`]);
                if (!buttonsByLine[line]) {
                    buttonsByLine[line] = [];
                }
                buttonsByLine[line].push({
                    name: data[`btn${buttonNum}_name`],
                    link: data[`btn${buttonNum}_link`]
                });
            }

            // Add grouped buttons to data object
            data.buttonsByLine = buttonsByLine;
            
            showQuestion('Do you want to send this notification?', () => {
                console.log('Telegram Notification:', data);
                // Here you would typically send the data to your backend
                showAlert('Notification sent successfully!');
            });
        }

        // Add new telegram button input
        function addTelegramButton() {
            const buttonInputs = document.getElementById('buttonInputs');
            const newButton = document.createElement('div');
            newButton.className = 'setting-row';
            const buttonCount = buttonInputs.children.length + 1;
            
            newButton.innerHTML = `
                <div class="setting-item">
                    <label class="setting-label">Button ${buttonCount}</label>
                    <div class="telegram-button-row">
                        <input type="text" class="setting-input telegram-button-name" name="btn${buttonCount}_name" placeholder="Button Name">
                        <input type="url" class="setting-input telegram-button-url" name="btn${buttonCount}_link" placeholder="https://">
                        <input type="number" class="setting-input telegram-button-line" name="btn${buttonCount}_line" placeholder="Line" min="1" value="1">
                        <button type="button" class="delete-btn" onclick="deleteTelegramButton(this)">Delete</button>
                    </div>
                </div>
            `;
            
            buttonInputs.appendChild(newButton);
        }

        // Delete telegram button
        function deleteTelegramButton(btn) {
            const row = btn.closest('.setting-row');
            if (document.getElementById('buttonInputs').children.length > 1) {
                row.remove();
                renameTelegramButtons();
            } else {
                alert('Cannot delete the last button');
            }
        }

        // Rename telegram buttons after deletion
        function renameTelegramButtons() {
            const buttonInputs = document.getElementById('buttonInputs');
            const rows = buttonInputs.children;
            for (let i = 0; i < rows.length; i++) {
                const label = rows[i].querySelector('.setting-label');
                const nameInput = rows[i].querySelector('input[type="text"]');
                const linkInput = rows[i].querySelector('input[type="url"]');
                const lineInput = rows[i].querySelector('input[type="number"]');
                const buttonNum = i + 1;
                label.textContent = `Button ${buttonNum}`;
                nameInput.name = `btn${buttonNum}_name`;
                linkInput.name = `btn${buttonNum}_link`;
                lineInput.name = `btn${buttonNum}_line`;
            }
        }

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.tab-btn[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}Tab`).classList.add('active');
        }

        // Add new bet input with delete button
        function addBetInput() {
            const betInputs = document.getElementById('betInputs');
            const newBet = document.createElement('div');
            newBet.className = 'setting-row';
            const betCount = betInputs.children.length + 1;
            
            newBet.innerHTML = `
                <div class="setting-item">
                    <label class="setting-label">Bet ${betCount}</label>
                    <input type="number" class="setting-input" name="bet${betCount}" placeholder="0.00 BNB" step="0.01" required min="0.01">
                    <div class="error-message">Please enter a valid bet amount</div>
                </div>
                <button type="button" class="delete-btn" onclick="deleteBet(this)">Delete</button>
            `;
            
            betInputs.appendChild(newBet);
        }

        // Add new distribution input with delete button
        function addDistributionInput() {
            const distributionInputs = document.getElementById('distributionInputs');
            const newDist = document.createElement('div');
            newDist.className = 'distribution-item';
            const topCount = distributionInputs.children.length + 1;
            
            newDist.innerHTML = `
                <input type="text" class="distribution-input" value="Top ${topCount}" readonly>
                <input type="number" class="distribution-input" name="dist${topCount}" placeholder="0%" value="0" required min="0" max="100">
                <button type="button" class="delete-btn" onclick="deleteDistribution(this)">Delete</button>
                <div class="error-message">Please enter a value between 0 and 100</div>
            `;
            
            distributionInputs.appendChild(newDist);
        }

        // Delete bet row
        function deleteBet(btn) {
            const row = btn.closest('.setting-row');
            if (document.getElementById('betInputs').children.length > 1) {
                row.remove();
                renameBetInputs();
            } else {
                alert('Cannot delete the last bet setting');
            }
        }

        // Delete distribution row
        function deleteDistribution(btn) {
            const row = btn.closest('.distribution-item');
            if (document.getElementById('distributionInputs').children.length > 1) {
                row.remove();
                renameDistributionInputs();
            } else {
                alert('Cannot delete the last distribution setting');
            }
        }

        // Rename bet inputs after deletion
        function renameBetInputs() {
            const betInputs = document.getElementById('betInputs');
            const rows = betInputs.children;
            for (let i = 0; i < rows.length; i++) {
                const label = rows[i].querySelector('.setting-label');
                const input = rows[i].querySelector('.setting-input');
                label.textContent = `Bet ${i + 1}`;
                input.name = `bet${i + 1}`;
            }
        }

        // Rename distribution inputs after deletion
        function renameDistributionInputs() {
            const distributionInputs = document.getElementById('distributionInputs');
            const rows = distributionInputs.children;
            for (let i = 0; i < rows.length; i++) {
                const label = rows[i].querySelector('input[readonly]');
                const input = rows[i].querySelector('input[type="number"]');
                label.value = `Top ${i + 1}`;
                input.name = `dist${i + 1}`;
            }
        }

        // Add pagination related functions
        let currentBlacklistPage = 1;
        let blacklistData = []; // This will store all blacklisted wallets

        function updateBlacklistPage(action) {
            const pageSize = parseInt(document.getElementById('blacklistPageSize').value);
            const totalPages = Math.ceil(blacklistData.length / pageSize);
            
            if (action === 'prev' && currentBlacklistPage > 1) {
                currentBlacklistPage--;
            } else if (action === 'next' && currentBlacklistPage < totalPages) {
                currentBlacklistPage++;
            } else if (typeof action === 'number') {
                currentBlacklistPage = action;
            }

            document.getElementById('currentBlacklistPage').textContent = currentBlacklistPage;
            document.getElementById('totalBlacklistPages').textContent = totalPages || 1;

            renderBlacklistTable();
        }

        function renderBlacklistTable() {
            const pageSize = parseInt(document.getElementById('blacklistPageSize').value);
            const start = (currentBlacklistPage - 1) * pageSize;
            const end = start + pageSize;
            const tableBody = document.getElementById('blacklistTableBody');
            
            tableBody.innerHTML = '';
            
            const pageData = blacklistData.slice(start, end);
            pageData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.style = 'border-bottom: 1px solid rgba(255,215,0,0.1);';
                row.innerHTML = `
                    <td style="padding: 12px 16px; color: rgba(255,255,255,0.9); font-size: 12px; text-align: center; font-family: 'Press Start 2P', cursive;">${start + index + 1}</td>
                    <td style="padding: 12px 16px; color: rgba(255,255,255,0.9); font-size: 12px; font-family: 'Press Start 2P', cursive;">${item.wallet}</td>
                    <td style="padding: 12px 16px; color: rgba(255,255,255,0.9); font-size: 12px; font-family: 'Press Start 2P', cursive;">${item.reason}</td>
                    <td style="padding: 12px 16px; text-align: center;">
                        <button class="control-btn" onclick="unblacklistWallet(this)" data-wallet="${item.wallet}" style="width: 100%; background: transparent; color: #ffd700; border: 1px solid #ffd700; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 10px; font-family: 'Press Start 2P', cursive;">Unblacklist</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Update submitBlacklist function
        function submitBlacklist(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const walletAddress = formData.get('walletAddress');
            const reason = formData.get('reason');

            if (!walletAddress || !walletAddress.trim()) {
                showAlert('Please enter a wallet address');
                return;
            }

            if (!reason || !reason.trim()) {
                showAlert('Please enter a reason for blacklisting');
                return;
            }

            showQuestion(`Do you want to blacklist wallet ${walletAddress}?`, () => {
                console.log('Blacklisting wallet:', walletAddress, 'Reason:', reason);
                // Here you would typically send the data to your backend
                
                // Add to blacklistData array
                blacklistData.push({ wallet: walletAddress, reason: reason });
                
                // Update table
                updateBlacklistPage(Math.ceil(blacklistData.length / parseInt(document.getElementById('blacklistPageSize').value)));
                
                form.reset();
                showAlert('Wallet has been blacklisted!');
            });
        }

        // Update unblacklistWallet function
        function unblacklistWallet(btn) {
            const wallet = btn.getAttribute('data-wallet');
            const item = blacklistData.find(x => x.wallet === wallet);
            if (!item) return;

            showQuestion(`Do you want to unblacklist wallet ${wallet}?\nReason for blacklist: ${item.reason}`, () => {
                console.log('Unblacklisting wallet:', wallet);
                // Here you would typically send the data to your backend
                
                // Remove from blacklistData array
                blacklistData = blacklistData.filter(x => x.wallet !== wallet);
                
                // Update table
                updateBlacklistPage(currentBlacklistPage);
                
                showAlert('Wallet has been unblacklisted!');
            });
        }

        // Initialize with some sample data
        blacklistData = [
            { wallet: '0x1234...5678', reason: 'Sample reason for blacklisting this wallet' },
            // Add more sample data as needed
        ];
        renderBlacklistTable();
    </script>
</body>
</html> 